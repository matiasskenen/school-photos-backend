<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Galería de Fotos - Plataforma Escolar</title>
        <script src="https://cdn.tailwindcss.com"></script>
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet" />
        <link rel="stylesheet" href="/assets/css/gallery.css" />
    </head>
    <body class="min-h-screen flex flex-col">
        <!-- Header -->
        <header class="bg-white shadow-md py-4">
            <div class="container flex justify-between items-center">
                <div class="text-2xl font-bold text-indigo-700">[ LOGO FOTÓGRAFO ]</div>
                <nav>
                    <ul class="flex space-x-6">
                        <li><a href="index.html" class="text-gray-700 hover:text-indigo-600 font-medium">Inicio</a></li>
                        <li><a href="gallery.html" class="text-gray-700 hover:text-indigo-600 font-medium">Galeria</a></li>
                        <li><a href="#" class="text-gray-700 hover:text-indigo-600 font-medium">Cómo Funciona</a></li>
                        <li><a href="#" class="text-gray-700 hover:text-indigo-600 font-medium">Contacto</a></li>
                        <li>
                            <a href="#" class="text-gray-700 hover:text-indigo-600 font-medium" id="cartLink">
                                Carrito (
                                <span id="cart-count">0</span>
                                )
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </header>

        <!-- Main Content -->
        <main class="flex-grow container py-8">
            <div class="card p-8">
                <h1 class="text-3xl font-bold text-gray-800 mb-6">Buscar Fotos Escolares</h1>

                <!-- Selector de colegios/álbumes disponibles -->
                <div class="mb-4 flex flex-col md:flex-row gap-2">
                    <label for="albumSelector" class="block mb-2 font-medium text-gray-700 sr-only">Seleccionar Colegio / Álbum:</label>
                    <select id="albumSelector" class="input-field flex-1">
                        <option value="">-- Elegí un colegio / álbum --</option>
                        <!-- Opciones de álbumes se cargarán aquí dinámicamente -->
                    </select>
                    <button id="searchButton" class="btn-primary flex-shrink-0">Buscar Fotos</button>
                </div>

                <!-- Mensajes de estado y carga -->
                <div id="message" class="message hidden"></div>
                <div id="loading" class="text-center mt-4 hidden">
                    <span class="loading-spinner"></span>
                    Cargando fotos...
                </div>

                <!-- Álbumes recientes (si los hay) - Siempre visible -->
                <h2 class="text-xl font-semibold text-gray-700 mb-4 mt-8" id="recentAlbumsTitle">Últimos Álbumes / Destacados</h2>
                <div id="recentAlbumsContainer" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-4 mb-8">
                    <!-- Tarjetas de álbumes recientes se cargarán aquí dinámicamente por JS -->
                    <p class="text-gray-500 col-span-full text-center" id="noRecentAlbumsMessage">No hay álbumes recientes disponibles.</p>
                </div>

                <!-- Contenedor para Galería y Checkout (inicialmente oculto, aparece al buscar) -->
                <div id="contentAfterSearch" class="hidden">
                    <!-- Galería de Fotos -->
                    <h2 class="text-xl font-semibold text-gray-700 mb-4 mt-8" id="galleryTitle">Fotos del Álbum:</h2>
                    <div id="galleryContainer" class="photo-grid">
                        <!-- Las fotos se cargarán aquí dinámicamente -->
                        <p class="text-gray-500 col-span-full text-center" id="noPhotosMessage">No se han cargado fotos. Usa el buscador.</p>
                    </div>

                    <!-- ELIMINADO: Botón de Checkout en la galería principal -->
                    <!-- <div class="mt-8 text-right">
                    <button id="checkoutButton" class="btn-primary">Ir a Pagar (<span id="cart-total-checkout">$0.00</span> ARS)</button>
                </div> -->
                </div>
            </div>
        </main>

        <!-- Modal de Detalle de Foto / Compra (inicialmente oculto) -->
        <section id="photo-detail-modal" class="modal hidden">
            <div class="modal-content flex flex-col md:flex-row gap-6">
                <!-- Botón para cerrar el modal -->
                <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl" onclick="hidePhotoDetailModal()">&times;</button>
                <div class="relative md:w-2/3">
                    <!-- Imagen grande con marca de agua -->
                    <img id="modal-photo-img" src="" alt="Foto Detallada" class="w-full h-auto rounded-lg" />
                    <div class="watermark-overlay"></div>
                </div>
                <div class="md:w-1/3 flex flex-col justify-between">
                    <div>
                        <!-- Información de la foto -->
                        <h3 id="modal-photo-title" class="text-2xl font-bold mb-2"></h3>
                        <p class="text-gray-600 mb-1">
                            **Evento:**
                            <span id="modal-photo-event"></span>
                        </p>
                        <p class="text-gray-600 mb-4">
                            **Colegio:**
                            <span id="modal-photo-school"></span>
                        </p>
                        <p id="modal-photo-price" class="text-4xl font-extrabold text-indigo-700 mb-6"></p>
                    </div>
                    <div>
                        <!-- Botones de acción -->
                        <button id="modal-add-to-cart-btn" class="btn-primary w-full mb-3">AÑADIR AL CARRITO</button>
                        <button id="modal-buy-now-btn" class="btn-secondary w-full">COMPRAR AHORA</button>
                        <p class="text-sm text-gray-500 mt-4 text-center">*Al comprar, recibirás la foto en alta resolución y sin marca de agua.</p>
                    </div>
                    <!-- Campo de email para comprar ahora -->
                    <div id="email-buy-now" class="mt-4 hidden">
                        <label for="buyNowEmail" class="block text-sm font-medium text-gray-700">Tu email para recibir la foto:</label>
                        <input type="email" id="buyNowEmail" class="input-field mt-1 w-full" placeholder="ejemplo@correo.com" />
                        <button id="confirmBuyNowBtn" class="btn-primary w-full mt-3">Confirmar Compra</button>
                    </div>
                </div>
            </div>
        </section>

        <!-- NUEVO MODAL DE CARRITO -->
        <section id="cart-modal" class="modal hidden">
            <div class="modal-content w-full max-w-2xl">
                <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl" onclick="hideCartModal()">&times;</button>
                <h2 class="text-3xl font-bold text-gray-800 mb-6 text-center">🛒 Tu Carrito de Compras</h2>

                <div id="cart-modal-items-container" class="border-t border-b border-gray-200 py-4 mb-6">
                    <!-- Los ítems del carrito se cargarán aquí dinámicamente -->
                    <p id="cart-modal-empty-message" class="text-gray-500 text-center py-4">El carrito está vacío.</p>
                </div>

                <div class="cart-total-summary">
                    <p>
                        Subtotal: $
                        <span id="cart-modal-subtotal">0.00</span>
                        ARS
                    </p>
                    <p class="total-price">
                        Total a Pagar: $
                        <span id="cart-modal-total">0.00</span>
                        ARS
                    </p>
                </div>

                <div class="flex flex-col sm:flex-row justify-end gap-4 mt-6">
                    <button id="cart-modal-checkout-btn" class="btn-primary w-full sm:w-auto">IR A PAGAR (Mercado Pago)</button>
                    <button class="btn-secondary w-full sm:w-auto" onclick="hideCartModal()">Seguir Comprando</button>
                </div>
            </div>
        </section>
        <section id="cart-email-modal" class="modal hidden">
            <div class="modal-content w-full max-w-md">
                <button class="absolute top-4 right-4 text-gray-500 hover:text-gray-800 text-2xl" onclick="hideCartEmailModal()">&times;</button>

                <!-- Texto de aclaración -->
                <p class="mb-4 text-gray-700 text-center">Por favor, ingresa tu email para recibir la confirmación y enlace de descarga de tus fotos.</p>

                <!-- Campo de email -->
                <input type="email" id="cartEmailInput" class="input-field w-full mb-3" placeholder="ejemplo@correo.com" required />
                <p id="cartEmailError" class="text-red-500 text-sm mb-4 hidden">Por favor, introduce un email válido.</p>

                <!-- Botón confirmar -->
                <button id="cartEmailConfirmBtn" class="btn-primary w-full">Confirmar Compra</button>
            </div>
        </section>

        <!-- Footer -->
        <footer class="bg-gray-800 text-white py-6 mt-auto">
            <div class="container text-center text-sm">
                <p>&copy; 2025 [Nombre del Fotógrafo]. Todos los derechos reservados.</p>
                <p class="mt-2">Contacto: info@fotografo.com | Tel: +54 9 11 1234-5678</p>
                <div class="flex justify-center space-x-4 mt-3">
                    <a href="#" class="hover:text-indigo-400">Facebook</a>
                    <a href="#" class="hover:text-indigo-400">Instagram</a>
                </div>
            </div>
        </footer>

        <script src="/config.js"></script>
        <!-- Asegúrate de que esta URL sea correcta para tu backend -->
        <script src="/js/gallery.js"></script>
    </body>
</html>
